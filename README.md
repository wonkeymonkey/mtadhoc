TODO: Clean code, this is a first draft with unused functions from the previous version laying around
